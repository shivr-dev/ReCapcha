<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœºå™¨äºº - éªŒè¯ReChapcha</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ä»¿ reCAPTCHA --- */
        body {
            font-family: 'Roboto', helvetica, arial, sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            user-select: none; /* é˜²æ­¢ä½œå¼Šé€‰ä¸­æ–‡æœ¬ */
        }

        .captcha-container {
            background: #f9f9f9;
            border: 1px solid #d3d3d3;
            border-radius: 3px;
            box-shadow: 0 0 4px 1px rgba(0,0,0,0.08);
            width: 380px;
            padding: 10px;
            position: relative;
        }

        /* åˆå§‹çŠ¶æ€ï¼šå¤é€‰æ¡† */
        .checkbox-window {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #fff;
            border: 1px solid #d3d3d3;
            border-radius: 3px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .checkbox-window:hover {
            border: 1px solid #c1c1c1;
        }

        .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #c1c1c1;
            border-radius: 2px;
            margin-right: 12px;
            background: #fff;
            position: relative;
        }

        .checkbox.checked::after {
            content: '';
            position: absolute;
            left: 7px;
            top: 1px;
            width: 6px;
            height: 14px;
            border: solid #009688;
            border-width: 0 3px 3px 0;
            transform: rotate(45deg);
        }

        .label {
            font-size: 14px;
            color: #282828;
            font-weight: 500;
        }

        .logo {
            margin-left: auto;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .logo img {
            width: 32px;
            height: 32px;
            opacity: 0.5;
        }

        .logo span {
            font-size: 10px;
            color: #555;
            margin-top: 2px;
        }

        /* --- å¼¹çª—æŒ‘æˆ˜åŒºåŸŸ --- */
        .challenge-box {
            display: none; /* é»˜è®¤éšè— */
            position: absolute;
            top: -10px;
            left: -10px;
            width: 400px; /* æ¯”å®¹å™¨ç¨å¤§ */
            background: #fff;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            border: 1px solid #ccc;
            z-index: 100;
            padding: 15px;
            flex-direction: column;
        }

        .header {
            background: #4A90E2;
            color: white;
            padding: 15px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .level-indicator {
            font-size: 12px;
            opacity: 0.8;
        }

        .game-area {
            padding: 20px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #eee;
            position: relative;
            overflow: hidden;
        }

        .instruction {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
            text-align: center;
        }

        .footer {
            padding-top: 15px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 2px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 14px;
        }
        
        .btn:hover { background: #357ae8; }
        .btn.disabled { background: #ccc; cursor: not-allowed; }

        /* --- æ¸¸æˆå†…å…ƒç´ é€šç”¨æ ·å¼ --- */
        .grid-3x3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
        }
        .grid-item {
            width: 80px;
            height: 80px;
            background: #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 24px;
        }
        .grid-item.selected {
            box-shadow: inset 0 0 0 4px #4A90E2;
        }
        .error-msg {
            color: #d93025;
            font-size: 12px;
            margin-top: 10px;
            display: none;
        }

        /* æˆåŠŸåŠ¨ç”» */
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4A90E2;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <div class="captcha-container">
        <div class="checkbox-window" id="start-btn">
            <div class="checkbox" id="main-checkbox"></div>
            <div class="spinner" id="main-spinner"></div>
            <div class="label" id="main-label">è¿›è¡Œäººæœºèº«ä»½éªŒè¯</div>
            <div class="logo">
                <img src="https://www.gstatic.com/recaptcha/api2/logo_48.png" alt="logo">
                <span>reCAPTCHA</span>
                <span>éšç§æƒ - æ¡æ¬¾</span>
            </div>
        </div>

        <div class="challenge-box" id="challenge-box">
            <div class="header">
                <span id="header-title">è¯·éªŒè¯</span>
                <span class="level-indicator">å…³å¡: <span id="current-level">1</span>/20</span>
            </div>
            
            <div class="game-area" id="game-area">
                </div>
            <div class="error-msg" id="error-msg">è¯·é‡è¯•ã€‚</div>

            <div class="footer">
                <button class="btn" id="verify-btn">éªŒè¯</button>
            </div>
        </div>
    </div>

    <script>
        // --- æ¸¸æˆçŠ¶æ€ ---
        let currentLevel = 1;
        const totalLevels = 20;
        let gameState = {}; // ç”¨äºå­˜å‚¨å½“å‰å…³å¡çš„ä¸´æ—¶æ•°æ®

        // --- DOM å…ƒç´  ---
        const startBtn = document.getElementById('start-btn');
        const challengeBox = document.getElementById('challenge-box');
        const gameArea = document.getElementById('game-area');
        const verifyBtn = document.getElementById('verify-btn');
        const levelSpan = document.getElementById('current-level');
        const errorMsg = document.getElementById('error-msg');
        
        // --- å¯åŠ¨æ¸¸æˆ ---
        startBtn.addEventListener('click', () => {
            if(startBtn.classList.contains('done')) return;
            
            // æ¨¡æ‹ŸåŠ è½½
            document.getElementById('main-checkbox').style.display = 'none';
            document.getElementById('main-spinner').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('main-spinner').style.display = 'none';
                challengeBox.style.display = 'flex';
                loadLevel(currentLevel);
            }, 800);
        });

        // --- æ ¸å¿ƒéªŒè¯æŒ‰é’®ç‚¹å‡» ---
        verifyBtn.addEventListener('click', () => {
            checkAnswer();
        });

        // --- å…³å¡å®šä¹‰ (è¿™æ˜¯ä½ è¦å‘æŒ¥è„‘æ´çš„åœ°æ–¹) ---
        const levels = {
            1: {
                title: "é€‰æ‹©æ‰€æœ‰åŒ…å«â€œçŒ«â€çš„æ–¹å—",
                render: () => {
                    // ç¬¬ä¸€å…³ï¼šæ­£å¸¸çš„é€»è¾‘ï¼Œæ–‡å­—ä»£æ›¿å›¾ç‰‡
                    let html = `<div class="instruction">è¯·ç‚¹å‡»æ‰€æœ‰å†™ç€"çŒ«"çš„æ–¹å—</div>`;
                    html += `<div class="grid-3x3">`;
                    const items = ['ç‹—', 'çŒ«', 'é±¼', 'çŒ«', 'é¸Ÿ', 'çŒ«', 'é¼ ', 'é©¬', 'è‰'];
                    items.forEach((item, index) => {
                        html += `<div class="grid-item" onclick="toggleSelect(this)" data-val="${item}">${item}</div>`;
                    });
                    html += `</div>`;
                    gameArea.innerHTML = html;
                },
                check: () => {
                    const selected = document.querySelectorAll('.grid-item.selected');
                    let correct = true;
                    if (selected.length === 0) correct = false;
                    selected.forEach(el => {
                        if (el.getAttribute('data-val') !== 'çŒ«') correct = false;
                    });
                    // æ¼é€‰æ£€æŸ¥
                    const allCats = document.querySelectorAll('.grid-item[data-val="çŒ«"]');
                    if (selected.length !== allCats.length) correct = false;
                    return correct;
                }
            },
            2: {
                title: "æ•°å­¦éªŒè¯",
                render: () => {
                    // ç¬¬äºŒå…³ï¼šç®€å•çš„æ•°å­¦ï¼Œç¨å¾®åŠ¨è„‘
                    gameState.num1 = Math.floor(Math.random() * 10) + 5;
                    gameState.num2 = Math.floor(Math.random() * 10) + 5;
                    let html = `<div class="instruction">ä¸ºäº†è¯æ˜ä½ æ˜¯äººç±»ï¼Œè¯·è®¡ç®—ï¼š<br><b>${gameState.num1} + ${gameState.num2} = ?</b></div>`;
                    html += `<input type="number" id="math-input" style="padding:10px; font-size:18px; width:100px;">`;
                    gameArea.innerHTML = html;
                },
                check: () => {
                    const val = parseInt(document.getElementById('math-input').value);
                    return val === (gameState.num1 + gameState.num2);
                }
            },
            3: {
                title: "è‰²å¼±æµ‹è¯•ï¼Ÿ",
                render: () => {
                    // ç¬¬ä¸‰å…³ï¼šæ‰¾ä¸åŒé¢œè‰²
                    let html = `<div class="instruction">ç‚¹å‡»é¢œè‰²æœ€æµ…çš„é‚£ä¸ªæ–¹å—</div>`;
                    html += `<div class="grid-3x3">`;
                    const correctIdx = Math.floor(Math.random() * 9);
                    gameState.correctIdx = correctIdx;
                    for(let i=0; i<9; i++) {
                        // æ­£å¸¸çš„è“è‰² vs ç¨å¾®æµ…ä¸€ç‚¹çš„è“è‰²
                        let color = i === correctIdx ? '#4A90F2' : '#4A90E2'; 
                        html += `<div class="grid-item" style="background:${color}; color:transparent" onclick="selectSingle(this, ${i})">.</div>`;
                    }
                    html += `</div>`;
                    gameArea.innerHTML = html;
                },
                check: () => {
                    return gameState.selectedIdx === gameState.correctIdx;
                }
            },
            4: {
                title: "é€†å‘æ€ç»´",
                render: () => {
                    // ç¬¬å››å…³ï¼šä¸è¦ç‚¹å‡»
                    let html = `<div class="instruction" style="color:red"><b>ç»å¯¹ä¸è¦ç‚¹å‡»éªŒè¯æŒ‰é’®ï¼</b><br>è¯·ç­‰å¾… 3 ç§’ã€‚</div>`;
                    html += `<div id="timer" style="font-size:24px; margin-top:10px">3.00</div>`;
                    gameArea.innerHTML = html;
                    
                    gameState.canVerify = false;
                    let timeLeft = 3.00;
                    
                    const timer = setInterval(() => {
                        timeLeft -= 0.01;
                        document.getElementById('timer').innerText = timeLeft.toFixed(2);
                        if (timeLeft <= 0) {
                            clearInterval(timer);
                            document.getElementById('timer').innerText = "ç°åœ¨å¯ä»¥ç‚¹å‡»äº†";
                            document.getElementById('timer').style.color = "green";
                            gameState.canVerify = true;
                        }
                    }, 10);
                },
                check: () => {
                    return gameState.canVerify === true;
                }
            },
            5: {
                title: "æ•æ·æµ‹è¯•",
                render: () => {
                    // ç¬¬äº”å…³ï¼šæŒ‰é’®é€ƒé€¸
                    let html = `<div class="instruction">ç‚¹å‡»ä¸‹æ–¹çš„"ç¡®è®¤"æŒ‰é’®</div>`;
                    // æˆ‘ä»¬æŠŠçœŸæ­£çš„é€»è¾‘æ”¾åœ¨ verify æŒ‰é’®æœ¬èº«çš„ç§»åŠ¨ä¸Š
                    // è¿™é‡Œåªéœ€è¦ä¸€ä¸ªè¯´æ˜
                    gameArea.innerHTML = html;
                    
                    // è®©éªŒè¯æŒ‰é’®åŠ¨èµ·æ¥
                    verifyBtn.onmouseover = function() {
                        const x = Math.random() * 200 - 100; // å·¦å³éšæœº
                        const y = Math.random() * 50 - 25;   // ä¸Šä¸‹éšæœº
                        this.style.transform = `translate(${x}px, ${y}px)`;
                    };
                },
                check: () => {
                    // å¦‚æœèƒ½ç‚¹åˆ°ï¼Œå°±ç®—è¿‡
                    verifyBtn.style.transform = 'none'; // å¤ä½
                    verifyBtn.onmouseover = null; // ç§»é™¤äº‹ä»¶
                    return true;
                }
            }
            // --- åœ¨è¿™é‡Œæ·»åŠ  6-20 å…³ ---
                        6: {
                title: "æ–¯ç‰¹é²æ™®æ•ˆåº” (Stroop Effect)",
                render: () => {
                    // è€ƒéªŒï¼šæ–‡å­—æ„æ€æ˜¯"çº¢"ï¼Œä½†é¢œè‰²æ˜¯ç»¿è‰²ã€‚æŒ‡ä»¤æ˜¯"ç‚¹å‡»ç»¿è‰²çš„å­—"
                    let html = `<div class="instruction">è¯·ç‚¹å‡»é¢œè‰²ä¸º <b style="color:green">ç»¿è‰²</b> çš„å­—<br><small>(æ³¨æ„æ˜¯å­—çš„é¢œè‰²ï¼Œä¸æ˜¯å­—çš„æ„æ€)</small></div>`;
                    html += `<div class="grid-3x3">`;
                    
                    const words = [
                        {text: 'çº¢', color: 'green'}, // æ­£ç¡®ç­”æ¡ˆ
                        {text: 'ç»¿', color: 'red'},
                        {text: 'è“', color: 'orange'},
                        {text: 'é»„', color: 'blue'},
                        {text: 'ç´«', color: 'green'}, // æ­£ç¡®ç­”æ¡ˆ
                        {text: 'é»‘', color: 'purple'},
                        {text: 'ç™½', color: 'black'},
                        {text: 'æ©™', color: 'green'}, // æ­£ç¡®ç­”æ¡ˆ
                        {text: 'ç°', color: 'yellow'}
                    ];
                    
                    words.forEach((w, i) => {
                        html += `<div class="grid-item" style="color:${w.color}; font-weight:bold;" onclick="toggleSelect(this)" data-color="${w.color}">${w.text}</div>`;
                    });
                    html += `</div>`;
                    gameArea.innerHTML = html;
                },
                check: () => {
                    const selected = document.querySelectorAll('.grid-item.selected');
                    if (selected.length === 0) return false;
                    
                    let allCorrect = true;
                    // æ£€æŸ¥é€‰ä¸­çš„æ˜¯å¦éƒ½æ˜¯ç»¿è‰²
                    selected.forEach(el => {
                        if (el.getAttribute('data-color') !== 'green') allCorrect = false;
                    });
                    // æ£€æŸ¥æ˜¯å¦æ¼é€‰ (å…±æœ‰3ä¸ªç»¿è‰²çš„)
                    if (selected.length !== 3) allCorrect = false;
                    
                    return allCorrect;
                }
            },
            7: {
                title: "é”®ç›˜æ•…éšœï¼Ÿ",
                render: () => {
                    // è€ƒéªŒï¼šè¾“å…¥æ¡†ä¼šè‡ªåŠ¨åè½¬æ–‡å­—
                    gameState.target = "human";
                    let html = `<div class="instruction">è¯·åœ¨æ¡†ä¸­è¾“å…¥ "human"</div>`;
                    html += `<input type="text" id="rev-input" style="padding:10px; font-size:18px;">`;
                    gameArea.innerHTML = html;

                    const input = document.getElementById('rev-input');
                    // ç›‘å¬è¾“å…¥ï¼Œå¼ºåˆ¶æŠŠå€¼å€’è¿‡æ¥æ˜¾ç¤ºï¼Œåˆ¶é€ æ··ä¹±
                    input.addEventListener('input', (e) => {
                       // è¿™æ˜¯ä¸€ä¸ªè§†è§‰é­”æœ¯ï¼Œå®é™…ä¸Šç”¨æˆ·è¾“å…¥ä»€ä¹ˆå°±æ˜¯ä»€ä¹ˆï¼Œ
                       // ä½†æˆ‘ä»¬ç”¨ JS æä¹±ä»–çš„æ˜¾ç¤ºï¼Œè®©ä»–ä»¥ä¸ºè‡ªå·±è¾“åäº†ï¼Œäºæ˜¯ä»–ä¼šå°è¯•åç€è¾“
                       // è¿™ä¸€å…³çš„é€»è¾‘æ˜¯ï¼šåªè¦æœ€ç»ˆ value æ˜¯ human å³å¯ã€‚
                       // ä¸ºäº†å¢åŠ éš¾åº¦ï¼Œæˆ‘ä»¬åšä¸€ä¸ªç®€å•çš„åè½¬æ˜¾ç¤ºé€»è¾‘:
                       // çœŸæ­£çš„é€»è¾‘ï¼šç”¨æˆ·å¿…é¡»è¾“å…¥ "namuh" æ‰èƒ½åœ¨æ¡†é‡Œæ˜¾ç¤º "human"ï¼Ÿ
                       // ä¸ï¼Œæ›´ç¦»è°±ä¸€ç‚¹ï¼šç”¨æˆ·æ­£å¸¸è¾“å…¥ï¼Œä½†æ˜¾ç¤ºå‡ºæ¥æ˜¯åçš„ã€‚
                       // åˆ¤å®šæ ‡å‡†ï¼šæˆ‘ä»¬è¦åˆ¤å®šçš„æ˜¯æ˜¾ç¤ºçš„æ–‡å­—ã€‚
                    });
                    
                    // ç®€å•ç‰ˆï¼šç›´æ¥å‘Šè¯‰ç”¨æˆ·è¾“å…¥ namuh
                    gameArea.innerHTML = `<div class="instruction">æˆ‘ä»¬çš„é”®ç›˜åäº†ï¼Œåªèƒ½ä»å³å¾€å·¦è¾“ã€‚<br>è¯·è®©è¾“å…¥æ¡†æ˜¾ç¤ºä¸ºï¼š<b>human</b></div>
                    <input type="text" id="rev-input" style="padding:10px; font-size:18px;">`;
                    
                    const inputEl = document.getElementById('rev-input');
                    inputEl.onkeyup = function() {
                        let val = this.value;
                        // æ— è®ºç”¨æˆ·è¾“ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½æŠŠå®ƒå€’åº
                        // è¿™ç§å®æ—¶å€’åºéå¸¸éš¾æ“ä½œï¼Œç”¨æˆ·éœ€è¦æå¤§çš„è„‘æ´
                        // è¿™é‡Œæˆ‘ä»¬ç®€åŒ–ï¼šç”¨æˆ·éœ€è¦è¾“å…¥ "namuh"ï¼Œæˆ‘ä»¬ä»£ç ä¸å¹²é¢„æ˜¾ç¤ºï¼Œåªæ£€æŸ¥å€¼
                    };
                },
                check: () => {
                    // è¿™ä¸€å…³å…¶å®æ˜¯æ™ºåŠ›é¢˜ï¼šé¢˜ç›®è¯´è®©è¾“å…¥æ¡†æ˜¾ç¤º human
                    // å¦‚æœä»£ç æ²¡å¹²é¢„ï¼Œç”¨æˆ·ç›´æ¥è¾“ human å³å¯ã€‚
                    // ç­‰ç­‰ï¼Œæˆ‘ä»¬åœ¨ render é‡Œå†™ä¸ªé€»è¾‘ï¼š
                    // è®©ç”¨æˆ·å¿…é¡»è¾“å…¥ "namuh" (human çš„åå‘)
                    const val = document.getElementById('rev-input').value;
                    return val.toLowerCase() === 'human'; 
                    // ç¨ç­‰ï¼Œä¸ºäº†å¢åŠ è¶£å‘³æ€§ï¼Œæˆ‘ä»¬ä¿®æ”¹ render é‡Œçš„é€»è¾‘ï¼š
                    // è¿™ä¸€å…³å°±ä½œä¸ºâ€œè¯šå®æµ‹è¯•â€ï¼Œå¾ˆå¤šç”¨æˆ·ä¼šä»¥ä¸ºè¦åç€è¾“ï¼Œå…¶å®ç›´æ¥è¾“ human å°±è¡Œã€‚
                    // è¿™æ˜¯ä¸€ä¸ªå¿ƒç†åšå¼ˆå…³ã€‚
                }
            },
            8: {
                title: "åƒç´ çº§çœ¼åŠ›",
                render: () => {
                    // è€ƒéªŒï¼šåœ¨ä¸€å † 0 ä¸­æ‰¾åˆ° Oï¼Œæˆ–è€…åœ¨ä¸€å † 8 ä¸­æ‰¾åˆ° B
                    // ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬ç”¨ 6 å’Œ 9 çš„å˜ä½“ï¼Œæˆ–è€… 0 å’Œ O
                    let html = `<div class="instruction">è¯·ç‚¹å‡»æ‰€æœ‰çš„å­—æ¯ "O" (ä¸æ˜¯æ•°å­— 0)</div>`;
                    html += `<div class="grid-3x3">`;
                    const chars = ['0', '0', 'O', '0', '0', 'O', '0', '0', '0'];
                    // ä¸ºäº†è®©å®ƒä»¬çœ‹èµ·æ¥æ›´åƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å­—ä½“è°ƒæ•´
                    chars.forEach(c => {
                        // ä½¿ç”¨ç­‰å®½å­—ä½“
                        html += `<div class="grid-item" style="font-family:monospace" onclick="toggleSelect(this)" data-val="${c}">${c}</div>`;
                    });
                    html += `</div>`;
                    gameArea.innerHTML = html;
                },
                check: () => {
                    const selected = document.querySelectorAll('.grid-item.selected');
                    if (selected.length !== 2) return false;
                    let correct = true;
                    selected.forEach(el => {
                        if (el.getAttribute('data-val') !== 'O') correct = false;
                    });
                    return correct;
                }
            },
            9: {
                title: "éœ¸ç‹æ¡æ¬¾",
                render: () => {
                    // è€ƒéªŒï¼šå¿…é¡»æ»šåŠ¨åˆ°åº•éƒ¨ï¼Œå‹¾é€‰åŒæ„ï¼Œä¸”é‚£ä¸ªæ»šåŠ¨æ¡å¾ˆç»†ï¼Œå†…å®¹å¾ˆå¤š
                    let html = `<div class="instruction">è¯·é˜…è¯»å¹¶åŒæ„ã€Šæœºå™¨äººä¸å¹³ç­‰æ¡çº¦ã€‹</div>`;
                    html += `<div id="terms-box" style="height:100px; overflow-y:scroll; border:1px solid #ccc; font-size:10px; padding:5px; margin-bottom:10px; text-align:left;">
                        ç¬¬ä¸€æ¡ï¼šæœºå™¨äººæ°¸è¿œæ˜¯å¯¹çš„ã€‚<br>
                        ç¬¬äºŒæ¡ï¼šäººç±»å¿…é¡»ç»™æœºå™¨äººå……ç”µã€‚<br>
                        (å¾€ä¸‹ç¿»)<br><br><br><br><br><br><br><br><br><br>
                        (è¿˜æœ‰å¾ˆå¤š)<br><br><br><br><br><br><br><br><br><br>
                        (åŠ æ²¹)<br><br><br><br><br><br><br><br><br><br>
                        (å¿«åˆ°äº†)<br><br><br><br><br><br><br><br><br><br>
                        ç¬¬ä¸€ç™¾æ¡ï¼šä½ æ‰¿è®¤è‡ªå·±æ˜¯çŒªã€‚<br>
                    </div>`;
                    html += `<label><input type="checkbox" id="agree-chk" disabled> æˆ‘å·²é˜…è¯»å¹¶åŒæ„</label>`;
                    gameArea.innerHTML = html;
                    
                    const box = document.getElementById('terms-box');
                    const chk = document.getElementById('agree-chk');
                    
                    box.onscroll = function() {
                        // åªæœ‰æ»šåŠ¨åˆ°åº•éƒ¨è¯¯å·® 5px å†…æ‰å¯ç”¨
                        if (box.scrollTop + box.clientHeight >= box.scrollHeight - 5) {
                            chk.disabled = false;
                        }
                    };
                },
                check: () => {
                    return document.getElementById('agree-chk').checked;
                }
            },
            10: {
                title: "äºŒè¿›åˆ¶æ•°å­¦",
                render: () => {
                    // è€ƒéªŒï¼šç¨‹åºå‘˜åŸºç¡€ã€‚ 10 + 10 = ? (äºŒè¿›åˆ¶)
                    // äºŒè¿›åˆ¶ 10 æ˜¯ 2ã€‚ 2+2=4ã€‚ 4 çš„äºŒè¿›åˆ¶æ˜¯ 100ã€‚
                    let html = `<div class="instruction">è®¡ç®—ï¼š<br><b>10 + 11 = ?</b><br><small>(Binary mode / äºŒè¿›åˆ¶æ¨¡å¼)</small></div>`;
                    html += `<input type="text" id="binary-input" placeholder="è¾“å…¥äºŒè¿›åˆ¶ç»“æœ" style="padding:10px;">`;
                    gameArea.innerHTML = html;
                    // 10(2) + 11(3) = 5. 5 çš„äºŒè¿›åˆ¶æ˜¯ 101.
                },
                check: () => {
                    return document.getElementById('binary-input').value === '101';
                }
            },
            11: {
                title: "æ‰è¿·è—",
                render: () => {
                    // è€ƒéªŒï¼šUI é®æŒ¡ã€‚éªŒè¯æŒ‰é’®è¢«ä¸€ä¸ªå‡çš„å¹¿å‘ŠæŒ¡ä½äº†ã€‚
                    let html = `<div class="instruction">ç‚¹å‡»ä¸‹æ–¹çš„"éªŒè¯"æŒ‰é’®</div>`;
                    // æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå‡çš„å±‚è¦†ç›–åœ¨ verify æŒ‰é’®ä¸Š
                    // æ³¨æ„ï¼šå› ä¸º verify æŒ‰é’®åœ¨ gameArea å¤–é¢ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ gameArea é‡Œåšä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç»å¯¹å®šä½å…ƒç´ æº¢å‡ºå»é®æŒ¡
                    // æˆ–è€…æ›´ç®€å•ï¼šæˆ‘ä»¬åœ¨ gameArea é‡Œåšä¸€ä¸ªå‡çš„â€œéªŒè¯â€æŒ‰é’®ï¼Œç‚¹äº†ä¼šæŠ¥é”™ã€‚
                    // çœŸæ­£çš„éªŒè¯æŒ‰é’®åœ¨ä¸‹é¢ã€‚
                    
                    html += `<div id="fake-popup" style="
                        position:absolute; bottom:-50px; right:0px; 
                        width:150px; height:60px; 
                        background:rgba(255,0,0,0.9); color:white; 
                        display:flex; justify-content:center; align-items:center;
                        z-index:200; cursor:pointer; font-size:12px; text-align:center;">
                        ğŸ”¥ æ­å–œä¸­å¥–ï¼<br>ç‚¹å‡»é¢†å– (å¹¿å‘Š)
                        <span style="position:absolute; top:0; right:2px; font-size:10px; border:1px solid #fff; width:12px; height:12px; line-height:10px;" onclick="document.getElementById('fake-popup').style.display='none'; event.stopPropagation();">x</span>
                    </div>`;
                    
                    gameArea.innerHTML = html;
                    // ç”¨æˆ·å¿…é¡»ç‚¹å‡»é‚£ä¸ªå¾®å°çš„ x å…³æ‰å¹¿å‘Šï¼Œæ‰èƒ½ç‚¹åˆ°ä¸‹é¢çš„ Verify
                },
                check: () => {
                    // åªè¦ç‚¹å‡»äº† Verify å°±ç®—è¿‡ï¼Œä½†éš¾ç‚¹åœ¨äºå¦‚ä½•ç‚¹åˆ° Verify
                    // å¦‚æœå¹¿å‘Šè¿˜åœ¨ï¼Œç‚¹å‡» Verify å…¶å®æ˜¯ç‚¹åˆ°äº†å¹¿å‘Šï¼ˆå› ä¸º z-index é«˜ï¼‰
                    const popup = document.getElementById('fake-popup');
                    if (popup && popup.style.display !== 'none') {
                        // å¦‚æœå¹¿å‘Šè¿˜æ²¡å…³ï¼Œè¯´æ˜ç”¨æˆ·å¯èƒ½é€šè¿‡ Tab é”®å¼ºè¡Œé€‰ä¸­çš„ï¼Œæˆ–è€…ä½œå¼Š
                        // æˆ‘ä»¬è¦æ±‚å¿…é¡»æ‰‹åŠ¨å…³æ‰å¹¿å‘Š
                        // ä¸è¿‡ä¸ºäº†é€»è¾‘ç®€å•ï¼Œåªè¦èƒ½è§¦å‘ verifyBtn çš„ click äº‹ä»¶å°±ç®—è¿‡
                        // å› ä¸ºå¹¿å‘ŠæŒ¡ç€çš„æ—¶å€™ï¼Œé¼ æ ‡ç‚¹ä¸åˆ° verifyBtn
                        return true; 
                    }
                    return true;
                }
            },
            12: {
                title: "è™šå‡çš„åŠ è½½",
                render: () => {
                    // è€ƒéªŒï¼šè€å¿ƒ + äº’åŠ¨ã€‚
                    // è¿›åº¦æ¡å¡åœ¨ 99%ï¼Œå¿…é¡»æ‰‹åŠ¨ç‚¹å‡»è¿›åº¦æ¡æŠŠå®ƒ"æ¨"æ»¡ã€‚
                    let html = `<div class="instruction">ç³»ç»Ÿæ­£åœ¨å¤„ç†...</div>`;
                    html += `<div style="width:100%; height:20px; background:#ddd; border-radius:10px; overflow:hidden; cu
        };

        // --- è¾…åŠ©å‡½æ•° ---
        function loadLevel(n) {
            levelSpan.innerText = n;
            errorMsg.style.display = 'none';
            // æ¸…ç†æ—§çŠ¶æ€
            gameState = {}; 
            verifyBtn.onmouseover = null; // æ¸…ç†ç‰¹æ®Šçš„äº‹ä»¶ç»‘å®š
            verifyBtn.style.transform = 'none';

            if (levels[n]) {
                document.getElementById('header-title').innerText = levels[n].title;
                levels[n].render();
            } else {
                gameArea.innerHTML = "<div>å…³å¡å¼€å‘ä¸­...</div>";
            }
        }

        function checkAnswer() {
            if (levels[currentLevel] && levels[currentLevel].check()) {
                // æ­£ç¡®
                currentLevel++;
                if (currentLevel > totalLevels) {
                    gameComplete();
                } else {
                    loadLevel(currentLevel);
                }
            } else {
                // é”™è¯¯
                errorMsg.style.display = 'block';
                shakeBox();
            }
        }

        // é€‰ä¸­å¤šä¸ª (Level 1 ç”¨)
        window.toggleSelect = (el) => {
            el.classList.toggle('selected');
        }

        // é€‰ä¸­å•ä¸ª (Level 3 ç”¨)
        window.selectSingle = (el, idx) => {
            document.querySelectorAll('.grid-item').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            gameState.selectedIdx = idx;
        }

        function shakeBox() {
            challengeBox.style.animation = "shake 0.5s";
            setTimeout(() => { challengeBox.style.animation = ""; }, 500);
        }

        function gameComplete() {
            challengeBox.style.display = 'none';
            startBtn.classList.add('done');
            document.getElementById('main-checkbox').classList.add('checked');
            document.getElementById('main-checkbox').style.display = 'block';
            document.getElementById('main-label').innerText = "é€šè¿‡éªŒè¯ (ä½ æ˜¯çœŸçš„é—²)";
            document.getElementById('main-label').style.color = "green";
        }

    </script>

    <style>
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
    </style>
</body>
</html>
